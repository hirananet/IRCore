!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("rxjs/webSocket"),require("rxjs")):"function"==typeof define&&define.amd?define("ircore",["exports","@angular/core","rxjs/webSocket","rxjs"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).ircore={},e.ng.core,e.rxjs.webSocket,e.rxjs)}(this,(function(e,n,t,s){"use strict";var i=function(){},r=function(){function e(){}return e.onPart=function(e){this.partResponse.emit(e)},e.setHandler=function(e){this.partResponse.subscribe((function(n){e.onPart(n)}))},e}();r.partResponse=new n.EventEmitter;var a=function(){},o=function(){function e(){}return e.kickParse=function(e){return/#([^\s]+)\s([^:]+)\s/.exec(e)},e.onKick=function(e){this.kicked.emit(e)},e.setHandler=function(e){this.kicked.subscribe((function(n){e.onKick(n)}))},e}();o.kicked=new n.EventEmitter;var c,u=function(){},h=function(){},d=function(){function e(){}return e.privateRequest=function(n){e.onPrivateRequest.emit(n)},e}();d.onPrivateRequest=new n.EventEmitter,(c=e.UModes||(e.UModes={}))[c.FOUNDER=0]="FOUNDER",c[c.ADMIN=1]="ADMIN",c[c.OPER=2]="OPER",c[c.HALFOPER=3]="HALFOPER",c[c.VOICE=4]="VOICE",c[c.BANNED=5]="BANNED";var l=function(n){"~"===n[0]?(this.mode=e.UModes.FOUNDER,n=n.substr(1)):"&"===n[0]?(this.mode=e.UModes.ADMIN,n=n.substr(1)):"@"===n[0]?(this.mode=e.UModes.OPER,n=n.substr(1)):"%"===n[0]?(this.mode=e.UModes.HALFOPER,n=n.substr(1)):"+"===n[0]&&(this.mode=e.UModes.VOICE,n=n.substr(1)),"#"===n[0]?(this.channel=n,this.name=n.substr(1)):(this.channel="#"+n,this.name=n)},f=function(){function e(){}return e.setChannelList=function(e,n){this.uChannelList[e]=n,this.channelListUpdated.emit(new m(e,n))},e.getChannels=function(){return this.uChannelList},e.setHandler=function(e){this.channelListUpdated.subscribe((function(n){e.onChannelList(n.user,n.channels)}))},e}();f.uChannelList={},f.channelListUpdated=new n.EventEmitter;var g=function(){},m=function(e,n){this.channels=[],this.user=e,this.channels=n},p=function(){function e(){this.isGOP=!1,this.isSecured=!1}return e.prototype.getLastLogin=function(){var e=new Date(1e3*parseInt(this.lastLogin,10)),n=e.getHours();n<10&&(n="0"+n);var t=e.getMinutes();t<10&&(t="0"+t);var s=e.getDate();s<10&&(s="0"+s);var i=e.getMonth()+1;return i<10&&(i="0"+i),s+"/"+i+"/"+e.getFullYear()+" "+n+":"+t},e.prototype.getIdle=function(){var e="",n=this.idle;if(!(n>=60))return this.idle+"s";var t=this.idle%60;if(t<10&&(t="0"+t),e=t+"s",!((n=Math.floor(n/60))>=60))return n+"m "+e;var s=n%60;if(s<10&&(s="0"+s),e=s+"m "+e,!((n=Math.floor(n/60))>=24))return n+"h "+e;var i=n%24;return i<10&&(i="0"+i),e=i+"h "+e,(n=Math.floor(n/24))+"d "+e},e}(),v=function(){function e(){}return e.addWhoisPartial=function(e,n,t){this.whoisdatas[e]||(this.whoisdatas[e]=new p,this.whoisdatas[e].username=e),this.whoisdatas[e][n]=t},e.finalWhoisMessage=function(e){this.onWhoisResponse.emit(this.whoisdatas[e])},e.getWhoisResponses=function(){return this.whoisdatas},e}();v.whoisdatas={},v.onWhoisResponse=new n.EventEmitter;var w=function(){},E=function(){function e(){}return e.addWhoData=function(e,n){this.usersWho[e]?(this.usersWho[e].isAway=n.isAway,this.usersWho[e].isNetOp=n.isNetOp,this.usersWho[e].mode=n.mode,this.usersWho[e].nick=n.nick,this.usersWho[e].rawMsg=n.rawMsg,this.usersWho[e].serverFrom=n.serverFrom):this.usersWho[e]=n,this.onWhoResponse.emit(this.usersWho[e])},e.getWhoData=function(e){return this.usersWho[e]},e.WHOUserParser=function(e){return/:([^\s]+)\s([0-9]+)\s([^\s]+)\s([^\s]+)\s([^\s]+)\s([^\s]+)\s([^\s]+)\s([^\s]+)\s(H|G)(\*?)(\~|\&|\@|\%|\+)?/.exec(e)},e}();E.usersWho={},E.onWhoResponse=new n.EventEmitter;var y=function(){},R=function(){},k=function(){function e(){}return e.addUsersToChannel=function(e,n){this.usersInChannel[e]=n,this.usersInChannelResponse.emit(new M(e,n))},e.getChannelOfMessage=function(e){var n=/(=|@|\*)([^:]+):/.exec(e);if(n&&n.length>2)return n[2].trim();console.error("GCOM, ",e)},e.getUsersInChannel=function(e){return this.usersInChannel[e]},e.setHandler=function(e){this.usersInChannelResponse.subscribe((function(n){e.onUserList(n.channel,n.userList)}))},e}();k.usersInChannel={},k.usersInChannelResponse=new n.EventEmitter;var M=function(e,n){this.channel=e,this.userList=n},C=function(){},b=function(e,n){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])})(e,n)};Object.create;Object.create;var O=function(n){"~"===n[0]?(this.mode=e.UModes.FOUNDER,n=n.substr(1)):"&"===n[0]?(this.mode=e.UModes.ADMIN,n=n.substr(1)):"@"===n[0]?(this.mode=e.UModes.OPER,n=n.substr(1)):"%"===n[0]?(this.mode=e.UModes.HALFOPER,n=n.substr(1)):"+"===n[0]&&(this.mode=e.UModes.VOICE,n=n.substr(1)),this.nick=n},S=function(e){function n(n,t){var s=e.call(this,n)||this;return s.channel=new l(t),s}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=e}b(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}(n,e),n}(O),I=function(){function e(){}return e.addChannels=function(e){this.channels.push(e)},e.newChannelList=function(){this.channels=[],this.channelListCreated.emit(this.channels)},e.getChannelList=function(){return this.channels},e}();I.channels=[],I.channelListCreated=new n.EventEmitter;var N=function(e,n,t,s){this.name=e,this.description=n,this.flags=t,this.users=s},P=function(){function e(){}return e.onNickAlreadyInUse=function(e){this.nickAlreadyInUse.emit(e)},e.onBanned=function(e){this.banned.emit(e)},e.onNickChanged=function(e){this.nickChanged.emit(e)},e.setHandlerNickAlreadyInUse=function(e){this.nickAlreadyInUse.subscribe((function(n){e.onNickAlreadyInUse(n)}))},e.setHandlerBanned=function(e){this.banned.subscribe((function(n){e.onBanned(n)}))},e.setHandlerNickChanged=function(e){this.nickChanged.subscribe((function(n){e.onNickChanged(n)}))},e}();P.nickAlreadyInUse=new n.EventEmitter,P.banned=new n.EventEmitter,P.nickChanged=new n.EventEmitter;var T=function(e,n){this.oldNick=e,this.newNick=n},A=function(){},H=function(){},x=function(){function e(){}return e.channelRegex=function(){return"#([a-zA-Z0-9_#]+)"},e.userRegex=function(){return"([a-zA-Z_][a-zA-Z0-9_]+)"},e.actionRegex=function(){return/\x01ACTION ([^\x01]+)\x01/},e.modeRegex=function(){return"(\\+|-)?([a-zA-Z]+)"},e.getRegex=function(e){return new RegExp(e)},e.pingRegex=function(e){return"^(.*(\\s|,|:))?("+e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+")((\\s|,|:).*)?$"},e}(),U=function(){function e(){}return e.modeParser=function(e){var n=e.split(" MODE ")[1];if(-1==n.indexOf("#")){var t=n.split(":");return[void 0,(s=x.getRegex(x.modeRegex()).exec(t[1]))[1],s[2].trim(),t[0].trim()]}var s=x.channelRegex()+"\\s"+x.modeRegex()+"\\s\\:?"+x.userRegex(),i=x.getRegex(s).exec(n);return i?[void 0,i[2],i[3].trim(),i[4]]:[void 0,void 0,n.split(":")[1],void 0]},e.changeMode=function(e){this.modeChange.emit(e)},e}();U.modeChange=new n.EventEmitter;var D=function(){function e(){}return e.onAway=function(e){this.awayResponse.emit(e)},e}();D.awayResponse=new n.EventEmitter;var L=function(){function e(){}return e.onIgnore=function(e){this.ignoreResponse.emit(e)},e}();L.ignoreResponse=new n.EventEmitter;var W=function(){};W.motdResponse=new n.EventEmitter,W.requirePasswordResponse=new n.EventEmitter;var j=function(){function e(){}return e.setChannelTopic=function(e,n){this.channelsTopics[e]=n,this.channelTopicResponse.emit(new F(e,n))},e.getChannelTopic=function(e){return this.channelsTopics[e]},e.findChannels=function(e){var n=/#([^\s]+)/g.exec(e);return n=n.slice(1)},e.setHandler=function(e){this.channelTopicResponse.subscribe((function(n){e.onTopicUpdate(n.channel,n.newTopic)}))},e}();j.channelsTopics={},j.channelTopicResponse=new n.EventEmitter;var G=function(){},F=function(e,n){this.channel=e,this.newTopic=n},_=function(){},V=function(){function e(){}return e.onQuit=function(e){this.quitResponse.emit(e)},e.setHandler=function(e){this.quitResponse.subscribe((function(n){e.onQuit(n)}))},e}();V.quitResponse=new n.EventEmitter;var q=function(e){this.user=new O(e)},z=function(){function e(){}return e.onJoin=function(e){this.joinResponse.emit(e)},e.setHandler=function(e){this.joinResponse.subscribe((function(n){e.onJoin(n)}))},e}();z.joinResponse=new n.EventEmitter;var K=function(){function e(){}return e.onServerResponse=function(e){this.serverResponse.emit(e)},e.onServerNoticeResponse=function(e){this.serverNoticeResponse.emit(e)},e}();K.serverResponse=new n.EventEmitter,K.serverNoticeResponse=new n.EventEmitter;var J=function(){function e(){}return e.onMessage=function(e){this.messageResponse.emit(e)},e.getMeAction=function(e){return x.actionRegex().exec(e.message)},e.setHandler=function(e){this.messageResponse.subscribe((function(n){e.onMessageReceived(n)}))},e}();J.messageResponse=new n.EventEmitter;var B,Q=function(){};(B=e.IndividualMessageTypes||(e.IndividualMessageTypes={}))[B.PRIVMSG=0]="PRIVMSG",B[B.CHANMSG=1]="CHANMSG",B[B.NOTIFY=2]="NOTIFY";var Y=function(){function e(){}return e.getTime=function(){var e=new Date;return(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},e.getDateStr=function(){var e=new Date,n=e.getMonth()+1,t=n<10?"0"+n:n,s=e.getDate();return(s<10?"0"+s:s)+"/"+t+"/"+e.getFullYear()},e}(),Z=function(){};Z.channelModerated=new n.EventEmitter;var $=function(){function n(){}return n.parseMessage=function(e){var n=[];return e.split("\r\n").forEach((function(e){var t=/:([^:]+):?(.*)/.exec(e),s=t[1],i=t[2],r=s.split(" "),a=new H;a.body=i,a.tag=s,a.partials=r,a.code=r[1];var o=/([^!]*!)?([^@]+@)?(.*)/.exec(r[0]),c=new A;o[2]?o[3]?(c.server=o[3],c.identitity=o[2].slice(0,o[1].length-1),c.nick=o[1].slice(0,o[1].length-1),a.simplyOrigin=c.nick):(c.server=o[2],c.identitity=o[1].slice(0,o[1].length-1),a.simplyOrigin=c.identitity):(c.server=o[1],a.simplyOrigin=c.server),a.origin=c,a.target=r[2],a.message=i,n.push(a)})),n},n.processMessage=function(n,t,s){if("319"===n.code){var c=[];return n.message.split(" ").forEach((function(e){var n=new l(e);c.push(n)})),v.addWhoisPartial(n.partials[3],"channelList",c),void f.setChannelList(n.partials[3],c)}if("718"!==n.code)if("378"!==n.code)if("312"!==n.code)if("313"!==n.code)if("379"!==n.code)if("330"!==n.code)if("671"!==n.code){if("317"===n.code)return v.addWhoisPartial(n.partials[3],"idle",n.partials[4]),void v.addWhoisPartial(n.partials[3],"lastLogin",n.partials[5]);if("318"!==n.code)if("352"!==n.code)if("353"!==n.code)if("321"!==n.code)if("322"!==n.code)if("433"!==n.code)if("474"!==n.code)if("NICK"!==n.code)if("MODE"!==n.code){if("301"===n.code){var g=new u;return g.author=n.partials[3],g.message=n.message,void D.onAway(g)}if("716"===n.code){var m=new u;m.author=n.partials[3],m.message=n.message,L.onIgnore(m)}if("464"!==n.code)if("404"!==n.code)if("375"!==n.code){if("PONG"!==n.code){if("NOTICE"===n.code)return n.simplyOrigin&&"*status"!==n.simplyOrigin&&"#"===n.target[0]?((b=new Q).messageType=e.IndividualMessageTypes.NOTIFY,b.author=n.simplyOrigin,b.message=n.message,b.meAction=!1,b.channel=n.target,b.time=Y.getTime(),b.date=Y.getDateStr(),void J.onMessage(b)):void K.onServerNoticeResponse(n);if("332"!==n.code)if("TOPIC"!==n.code){if("315"!==n.code){if("KICK"===n.code){var p=n.target,w=o.kickParse(t),y=new a;y.channel=new l(p),y.operator=n.message,y.userTarget=new O(w[2]),o.onKick(y)}if("PART"===n.code){(p=n.target)||(p=n.message);var M=new _;M.channel=new l(p),M.message=n.message,M.user=new O(n.simplyOrigin),r.onPart(M)}if("QUIT"===n.code&&V.onQuit(new q(n.simplyOrigin)),"JOIN"===n.code){var C=new i;p=n.message?n.message:n.target;C.channel=new l(p),C.user=new O(n.simplyOrigin),C.origin=n.origin,z.onJoin(C)}if("PRIVMSG"===n.code){var b,A=J.getMeAction(n);return(b=new Q).author=n.simplyOrigin,A?(b.message=A[1],b.meAction=!0):(b.message=n.message,b.meAction=!1),b.time=Y.getTime(),b.date=Y.getDateStr(),n.target===s?b.messageType=e.IndividualMessageTypes.PRIVMSG:(b.messageType=e.IndividualMessageTypes.CHANMSG,b.channel=n.target),b.mention=!!b.message&&b.message.indexOf(s)>=0,void J.onMessage(b)}K.onServerResponse(n)}}else j.setChannelTopic(n.target,n.message);else{var H=j.findChannels(t);j.setChannelTopic(H[0],n.message)}}}else W.motdResponse.emit(n);else Z.channelModerated.emit(n);else W.requirePasswordResponse.emit(n)}else{var x,G=U.modeParser(t);G[3]?((x=new h).userTarget=new O(G[3]),x.channelTarget=n.target,x.modeAdded="+"===G[1],x.mode=G[2],U.changeMode(x)):((x=new h).channelTarget=n.target,x.userTarget=new O(n.target),x.mode=G[2],U.changeMode(x))}else P.onNickChanged(new T(n.simplyOrigin,n.target?n.target:n.message));else P.onBanned("");else P.onNickAlreadyInUse("");else{var F=n.body.split("]");I.addChannels(new N(n.partials[3].slice(1),F[1],F[0].replace("[",""),parseInt(n.partials[4])))}else I.newChannelList();else{var B=k.getChannelOfMessage(t),$=n.message.trim().split(" "),X=[];$.forEach((function(e){X.push(new S(e,B))}));var ee=new l(B);k.addUsersToChannel(ee.name,X)}else{var ne=E.WHOUserParser(t);if(ne){var te=new R;te.serverFrom=ne[7],te.nick=ne[8],te.isAway="G"===ne[9],te.isNetOp="*"===ne[10],te.rawMsg=t;var se=ne[11];"~"===se?te.mode=e.UModes.FOUNDER:"&"===se?te.mode=e.UModes.ADMIN:"@"===se?te.mode=e.UModes.OPER:"%"===se?te.mode=e.UModes.HALFOPER:"+"===se&&(te.mode=e.UModes.VOICE),E.addWhoData(ne[8],te)}else console.error("BAD WHO RESPONSE PARSED: ",t,ne)}else v.finalWhoisMessage(n.partials[3])}else v.addWhoisPartial(n.partials[3],"isSecured",!0);else v.addWhoisPartial(n.partials[3],"userAccount",n.partials[4]);else{var ie=n.body.split(" ");v.addWhoisPartial(n.partials[3],"modes",ie[ie.length-1])}else v.addWhoisPartial(n.partials[3],"isGOP",!0);else v.addWhoisPartial(n.partials[3],"server",n.body);else v.addWhoisPartial(n.partials[3],"connectedFrom",n.body.replace("is connecting from ",""));else d.privateRequest(n.partials[3])},n}(),X=function(){};X.decorators=[{type:n.NgModule,args:[{declarations:[],imports:[],exports:[]}]}];var ee=function(){function n(){this.onOpenSubject=new s.Subject,this.onCloseSubject=new s.Subject}return n.prototype.connect=function(s,i){this.wss=t.webSocket({url:s,serializer:function(e){return e},deserializer:function(e){return e.data},openObserver:this.onOpenSubject,closeObserver:this.onCloseSubject});var r=this.wss.asObservable();return r.subscribe((function(e){n.messageReceived.emit(new se(i,e))}),(function(t){var s=new te;s.status=e.ConnectionStatus.ERROR,s.data={uuid:i,err:t},console.error("WS errror?",s.data),n.statusChanged.emit(s),n.connected=!1})),this.onCloseSubject.subscribe((function(){var t=new te;t.status=e.ConnectionStatus.DISCONNECTED,t.data=i,n.statusChanged.emit(t),n.connected=!1})),this.onOpenSubject.subscribe((function(){var t=new te;t.status=e.ConnectionStatus.CONNECTED,t.data=i,n.statusChanged.emit(t),n.connected=!0})),r},n.prototype.send=function(e){this.wss.next(e)},n.prototype.disconnect=function(){this.wss.complete()},n.isConnected=function(){return n.connected},n}();ee.messageReceived=new n.EventEmitter,ee.statusChanged=new n.EventEmitter,ee.connected=!1;var ne,te=function(){};(ne=e.ConnectionStatus||(e.ConnectionStatus={}))[ne.CONNECTED=0]="CONNECTED",ne[ne.DISCONNECTED=1]="DISCONNECTED",ne[ne.ERROR=2]="ERROR";var se=function(e,n){this.uuid=e,this.message=n},ie=function(){function e(){this.onChangeNick=new n.EventEmitter,P.setHandlerNickChanged(this)}return e.prototype.getNick=function(){return this.actualNick},e.prototype.setNick=function(e){this.actualNick=e,this.onChangeNick.emit(e)},e.prototype.onNickChanged=function(e){e.oldNick===this.actualNick&&(this.actualNick=e.newNick)},e}();ie.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new ie},token:ie,providedIn:"root"}),ie.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],ie.ctorParameters=function(){return[]};var re=function(){function n(e){var n=this;this.userSrv=e,ee.messageReceived.subscribe((function(e){if(0!==e.message.indexOf("PING"))0!==e.message.indexOf("ERROR")?$.parseMessage(e.message).forEach((function(t){$.processMessage(t,e.message,n.userSrv.getNick())})):console.error("Received error from stream: ",e.message);else{var t=e.message.slice(5);n.sendRaw("PONG "+t)}}))}return n.prototype.connect=function(e){this.webSocket=new ee,this.webSocket.connect(e,"WSocket")},n.prototype.handshake=function(e,t,s){this.sendRaw("ENCODING UTF-8"),s&&this.sendRaw("HOST "+s),this.sendRaw("USER "+e+" * * :"+n.clientName),this.setNick(t)},n.prototype.identify=function(e){this.sendRaw("PRIVMSG NickServ identify "+e)},n.prototype.serverPass=function(e,n){this.sendRaw("PASS "+e+":"+n)},n.prototype.setNick=function(e){this.sendRaw("NICK "+e),this.userSrv.setNick(e)},n.prototype.sendWhox=function(e){e="#"===e[0]?e:"#"+e,this.sendRaw("WHO "+e)},n.prototype.join=function(e){"#"!=e[0]&&(e="#"+e),this.sendRaw("JOIN "+e)},n.prototype.disconnect=function(){this.webSocket.disconnect()},n.prototype.sendRaw=function(e){this.webSocket.send(e)},n.prototype.sendMessageOrCommand=function(e,n){if("/"===e[0]){var t=e.slice(1),s=t.split(" ")[0].toLowerCase();if("query"===s&&(t=t.slice(5).trim()),"join"===s)return this.sendRaw(t),!1;if("umode"===s&&(t=t.replace("umode","mode "+this.userSrv.getNick())),"stop"===s)return stopEff(),!1;if("me"===s)return t=t.slice(2).trim(),this.sendRaw("PRIVMSG "+n+" :"+String.fromCharCode(1)+"ACTION "+t+String.fromCharCode(1)),this._triggerMessage(t,n,!0),!0;if("cs"===s&&(t=t.replace("cs","PRIVMSG ChanServ :")),"hc"===s&&(t=t.replace("hc","PRIVMSG HiraClient :")),"ns"===s&&(t=t.replace("ns","PRIVMSG NickServ :")),"msg"===s&&(t=t.replace("msg","PRIVMSG")),"leave"===s&&(t=t.replace("leave","PART")),"away"===s&&4===t.length){var i=new Date;t+=" AFK desde "+i.getDay()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+i.getHours()+":"+i.getMinutes()}return"back"===s&&(t=t.replace("back","away")),this.sendRaw(t),!1}return n?(this.sendRaw("PRIVMSG "+n+" :"+e),this._triggerMessage(e,n,!1)):this.sendRaw(e),!0},n.prototype._triggerMessage=function(n,t,s){var i=new Q;i.author=this.userSrv.getNick(),i.message=n,i.meAction=s,i.date=Y.getDateStr(),i.time=Y.getTime(),i.messageType="#"==t[0]?e.IndividualMessageTypes.CHANMSG:e.IndividualMessageTypes.PRIVMSG,i.messageType===e.IndividualMessageTypes.CHANMSG?i.channel=t:(i.privateAuthor=i.author,i.author=t),J.onMessage(i)},n.prototype.getWS=function(){return this.webSocket},n}();re.clientName="IRCoreV2",re.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new re(n.ɵɵinject(ie))},token:re,providedIn:"root"}),re.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],re.ctorParameters=function(){return[{type:ie}]};var ae=function(){function e(){}return e.setAvatarURL=function(e){this.avatarURL=e},e.getAvatarURL=function(){return this.avatarURL},e}(),oe=function(){this.users=[],this.messages=[]},ce=function(){},ue=function(){},he=function(e){var n=ae.getAvatarURL();this.image="string"==typeof e?n+e:n+e.nick,this.user=e},de=function(){function e(){}return e.getMeme=function(e,n){return this.memes.findIndex((function(n){return n===e}))>=0?this.memesLocation+e+this.memesExtension:void 0},e.getFace=function(e,n){return this.faces.findIndex((function(n){return n===e}))>=0?this.facesLocation+e+this.facesExtension:this.specialFaces[n]&&this.specialFaces[n].findIndex((function(n){return n===e}))>=0?this.specialLocation+e+this.facesExtension:"Gabriela-"===n?("magia"===e&&startEventEffect(),"primavera"===e&&startEventEffectPrimavera(),"verano"===e&&startEventEffectVerano(),"otono"===e&&startEventEffectOtono(),"cabritas"===e&&startEventEffectCabritas(),"regalos"===e&&startEventEffectRegalo(),"lluvia"===e&&startEventEffectMeteor(),void("kz2"===e&&startEventEffectKz2s())):"Alex"===n||"Tulkalex"===n||"Tulkalen"===n?void("kz2"===e&&startEventEffectKz2s()):void 0},e}();de.facesLocation="assets/faces/",de.specialLocation="assets/specials/",de.facesExtension=".png",de.memesLocation="assets/em-mem/",de.memesExtension="",de.specialFaces={"Gabriela-":["regla","magico","stamp"],Polsaker:["stamp"]},de.faces=["aaa","break","chaky","challenge","cry","ehh","facepalm","fap","fffpf","fu","fuckyeah","genius","hmmm","hpm","jij","laugh","LOL","magicBook","magicCircle","magicDrug","magichat","no","oka","rage","siuu","sparkle","stickmagic","stickmagic2","trollface","mog","why","WitchHat","why","yao","true","amazing","forever","notbad","brindis","buttcoin","cigar","cigar2","coffee","coffee2","coffee3","goatman","hacker","service","stick","wine","wineBottle","escoba","principito","baskerville","cumple","cumple2","abrazo","agua1","agua2","angry","barco","eagle","fatcat","fox","handshake","kiss","rose","tarta","te","whisky","zumo","burger","candy","caniche","celtic","coca","editorial","gaviota","goat","icecream","listado","magicwind","medal","musical","palette","pizza","podium","batido","fresas","wizard","xane"],de.memes=["baneo","baneo2","baneo3","buscar","buscar2","comunicacion","despedida","expulsar","hacker","hacker2","hacker3","hacker4","hacker5","hacker6","hacker7","hacker8","hacker9","hacker10","hacker11","hacker12","impuestos","impuestos2","llegada","magia","magia2","magia3","magia4","magia5","magia6","nopreguntas","nopreguntas2","topic","topic2"];var le,fe=function(){function n(){}return n.processMessage=function(e,t,s){var i=new me,r=/((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?/.exec(e);r&&(e=e.replace(r[0],""),i.youtube=r[5]);var a=/(http(s?):)([\/|.|\w|\s|-])*\.(?:jpg|gif|png)/.exec(e);a&&(e=e.replace(a[0],""),i.image=a[0]);var o=/(http|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?/.exec(e);o&&(e=e.replace(o[0],""),i.link=o[0]);var c=/^<([^>]+)>\s([^|]+)\|?(.*)$/.exec(e);c&&(i.quote={author:c[1],originalMessage:c[2]},e=c[3]);var u=document.createElement("div");u.textContent=e;var h=(e=u.innerHTML).match(/:([a-zA-Z0-9]+):/g);h&&h.forEach((function(n){var s=n.replace(":","").replace(":",""),i=de.getFace(s,t);i&&(e=e.replace(n,'<img src="'+i+'" class="faceEmote '+s+'" data-name="'+s+'" title=":'+s+'" alt=":'+s+'"/>'))}));var d=e.match(/;([a-zA-Z0-9]+);/g);return d&&d.forEach((function(n){var s=n.replace(";","").replace(";",""),i=de.getMeme(s,t);i&&(e=e.replace(n,'<img src="'+i+'" class="memeEmote '+s+'" data-name="'+s+'" title=";'+s+'" alt=";'+s+'"/>'))})),i.message=n.processPings(e,s),i},n.processPings=function(e,n){var t=x.getRegex(x.pingRegex(n)).exec(e);return t&&(e="",t[1]&&(e+=t[1]),t[2]&&(e+=t[2]),e+='<b class="ping">'+t[3]+"</b>",t[4]&&(e+=t[4]),t[5]&&(e+=t[5]),e=e.replace(", ,",",")),e},n.deconverHTML=function(e){var n=e.match(/\<img\ssrc\=\"([^"]+)\"\sclass\=\"([^"]+)\"\sdata-name="([^"]+)"\stitle="([^"]+)"\salt="([^"]+)"\/\>/g);return n&&n.forEach((function(n){var t=/\<img\ssrc\=\"([^"]+)\"\sclass\=\"([^"]+)\"\sdata-name="([^"]+)"\stitle="([^"]+)"\salt="([^"]+)"\/\>/.exec(n);e=e.replace(t[0],t[4])})),e},n.processUserMetadata=function(n){var t=n[0];"~"!==t&&"&"!==t&&"@"!==t&&"%"!==t&&"+"!==t||(n=n.slice(1));var s=new ge;return s.nick=n,"~"===t?s.status=e.UserStatuses.FOUNDER:"&"===t?s.status=e.UserStatuses.NET_OPERATOR:"@"===t?s.status=e.UserStatuses.OPERATOR:"%"===t?s.status=e.UserStatuses.HALF_OPERATOR:"+"===t&&(s.status=e.UserStatuses.VOICE),s},n}(),ge=function(){},me=function(){},pe=function(){};(le=e.UserStatuses||(e.UserStatuses={})).FOUNDER="FOUNDER",le.NET_OPERATOR="NET_OPERATOR",le.OPERATOR="OPERATOR",le.HALF_OPERATOR="HALF_OPERATOR",le.VOICE="VOICE",le.BANNED="BANNED";var ve=function(){function t(t){var s=this;this.userSrv=t,this.listChanged=new n.EventEmitter,this.messagesReceived=new n.EventEmitter,this.membersChanged=new n.EventEmitter,this.channels=[],z.setHandler(this),o.setHandler(this),r.setHandler(this),k.setHandler(this),f.setHandler(this),P.setHandlerNickChanged(this),j.setHandler(this),J.setHandler(this),Z.channelModerated.subscribe((function(e){var n="#"==e.partials[3][0]?e.partials[3].substring(1):e.partials[3],t=s.channels.find((function(e){return e.name===n}));t&&s.sendSpecialMSG(t,e.body)})),U.modeChange.subscribe((function(n){if(n.channelTarget!=n.userTarget.nick){var t="#"==n.channelTarget[0]?n.channelTarget.substring(1):n.channelTarget;if(o=s.channels.find((function(e){return e.name===t}))){var i=o.users.find((function(e){return e.nick===n.userTarget.nick}));i&&(n.modeAdded?n.mode.indexOf("q")>-1?i.mode=e.UModes.FOUNDER:n.mode.indexOf("a")>-1||n.mode.indexOf("A")>-1?i.mode=e.UModes.ADMIN:n.mode.indexOf("o")>-1||n.mode.indexOf("O")>-1?i.mode=e.UModes.OPER:n.mode.indexOf("h")>-1||n.mode.indexOf("H")>-1?i.mode=e.UModes.HALFOPER:(n.mode.indexOf("v")>-1||n.mode.indexOf("V")>-1)&&(i.mode=e.UModes.VOICE):i.mode=void 0,s.membersChanged.emit({channel:t,users:o.users}));var r=n.modeAdded?"agregó":"quitó",a=n.modeAdded?"+":"-";s.sendSpecialMSG(o,"Se "+r+' el modo "'+a+n.mode+'" a '+n.userTarget.nick)}}else{var o,c="#"==n.channelTarget[0]?n.channelTarget.substring(1):n.channelTarget;(o=s.channels.find((function(e){return e.name===c})))&&s.sendSpecialMSG(o,"Se cambió el modo del canal: "+n.mode)}})),this.history=JSON.parse(localStorage.getItem("chan_history")),this.history||(this.history={})}return t.prototype.saveHistory=function(e,n){this.history[e]||(this.history[e]=[]);var t=Object.assign({},n);t.fromHistory=!0,this.history[e].push(t),localStorage.setItem("chan_history",JSON.stringify(this.history))},t.prototype.getHistory=function(e){return this.history[e]},t.prototype.onChannelList=function(e,n){var t=this;if(e===this.userSrv.getNick()){var s=[];n.forEach((function(e){t.channels.find((function(n){return n.name===e.name}))||t.addChannel(e.name),s.push(e.name)})),this.channels.forEach((function(e,n){s.find((function(n){return n===e.name}))||t.channels.splice(n,1)})),this.listChanged.emit(this.channels)}},t.prototype.addChannel=function(e){var n=new oe;return n.name=e,n.topic=j.getChannelTopic(n.name),n.messages=[],this.channels.push(n),n},t.prototype.onUserList=function(e,n){var t=this.channels.find((function(n){return n.name===e}));t||(t=this.addChannel(e));var s=[];n.forEach((function(e){var n=t.users.find((function(n){return n.nick===e.nick}));if(n)n.mode=e.mode;else{var i=new O(e.nick);i.mode=e.mode,t.users.push(i)}s.push(e.nick)})),t.users.forEach((function(e,n){s.find((function(n){return e.nick===n}))||t.users.splice(n,1)})),this.membersChanged.emit({channel:e,users:t.users})},t.prototype.sendSpecialMSG=function(e,n){var t={message:n,date:Y.getTime()+" "+Y.getDateStr(),special:!1,target:e.name,notify:!0};e.messages.push(t),this.messagesReceived.emit(t)},t.prototype.onKick=function(e){if(e.userTarget.nick===this.userSrv.getNick())this.channels.splice(this.channels.findIndex((function(n){return n.name===e.channel.name}))),this.listChanged.emit(this.channels);else{var n=this.channels.find((function(n){return n.name===e.channel.name}));if(n){var t=n.users.findIndex((function(n){return n.nick===e.userTarget.nick}));t>=0&&n.users.splice(t,1)}else console.error("No se encontró el canal en el que se kickeó el usuario.",e.channel);this.membersChanged.emit({channel:e.channel.name,users:n.users}),this.sendSpecialMSG(n,e.userTarget.nick+" fué kickeado/a del canal por "+e.operator+".")}},t.prototype.onPart=function(e){if(e.user.nick===this.userSrv.getNick())this.channels.splice(this.channels.findIndex((function(n){return n.name===e.channel.name})),1),this.listChanged.emit(this.channels);else{var n=this.channels.find((function(n){return n.name===e.channel.name}));if(n){var t=n.users.findIndex((function(n){return n.nick===e.user.nick}));t>=0&&n.users.splice(t,1)}else console.error("No se encontró el canal en el que partió el usuario.",e.channel);this.membersChanged.emit({channel:e.channel.name,users:n.users}),this.sendSpecialMSG(n,e.user.nick+" se fué del canal")}},t.prototype.onJoin=function(e){if(e.user.nick===this.userSrv.getNick())this.channels.find((function(n){return n.name===e.channel.name}))||this.addChannel(e.channel.name),this.listChanged.emit(this.channels);else{var n=this.channels.find((function(n){return n.name===e.channel.name}));if(n){var t=new O(e.user.nick);t.mode=e.user.mode,n.users.push(t)}else console.error("No se encontró el canal en el que se unió el usuario.",e.channel);this.membersChanged.emit({channel:e.channel.name,users:n.users}),this.sendSpecialMSG(n,e.user.nick+" se unió al canal")}},t.prototype.onNickChanged=function(e){var n=this;this.channels.forEach((function(t){t.users.find((function(n){return n.nick===e.oldNick})).nick=e.newNick,n.membersChanged.emit({channel:t.name,users:t.users}),n.sendSpecialMSG(t,e.oldNick+" se cambió el nick a "+e.newNick)}))},t.prototype.onTopicUpdate=function(e,n){"#"===e[0]&&(e=e.substring(1));var t=this.channels.find((function(n){return n.name===e}));t?t.topic=n:console.error("No se encontró el canal en el que se cambió el topic. ",e)},t.prototype.getChannels=function(){return this.channels},t.prototype.getChannel=function(e){return this.channels.find((function(n){return n.name==e}))},t.prototype.onMessageReceived=function(n){if(n.messageType==e.IndividualMessageTypes.CHANMSG){var t="#"==n.channel[0]?n.channel.substring(1):n.channel,s=this.channels.find((function(e){return e.name==t})),i={message:n.message,messageWithMetadata:fe.processMessage(n.message,n.author,this.userSrv.getNick()),author:new he(n.author),date:n.date+" "+n.time,special:n.meAction,target:t};s.messages.push(i),this.messagesReceived.emit(i),this.saveHistory(t,i)}},t}();ve.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new ve(n.ɵɵinject(ie))},token:ve,providedIn:"root"}),ve.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],ve.ctorParameters=function(){return[{type:ie}]};var we=function(){this.messages=[]},Ee=function(){function t(e){this.userSrv=e,this.messagesReceived=new n.EventEmitter,this.newPrivOpened=new n.EventEmitter,this.closedPriv=new n.EventEmitter,this.privMsgs={},J.setHandler(this),this.history=JSON.parse(localStorage.getItem("pv_history")),this.history||(this.history={})}return t.prototype.onMessageReceived=function(n){if(n.messageType==e.IndividualMessageTypes.PRIVMSG){var t=n.privateAuthor?n.privateAuthor:n.author,s={message:n.message,messageWithMetadata:fe.processMessage(n.message,t,this.userSrv.getNick()),author:new he(t),date:n.date+" "+n.time,special:n.meAction,target:n.channel};this.privMsgs[n.author]||(this.newPrivOpened.emit(n.author),this.privMsgs[n.author]=new we,this.privMsgs[n.author].user=n.author),this.privMsgs[n.author].messages.push(s),this.messagesReceived.emit(s),this.saveHistory(n.author,s)}},t.prototype.saveHistory=function(e,n){this.history[e]||(this.history[e]=[]);var t=Object.assign({},n);t.fromHistory=!0,this.history[e].push(t),localStorage.setItem("pv_history",JSON.stringify(this.history))},t.prototype.getHistory=function(e){return this.history[e]},t.prototype.getPrivate=function(e){return this.privMsgs[e]||(this.privMsgs[e]=new we,this.privMsgs[e].user=e,this.newPrivOpened.emit(e)),this.privMsgs[e]},t.prototype.closePrivate=function(e){delete this.privMsgs[e],this.closedPriv.emit(e)},t}();Ee.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new Ee(n.ɵɵinject(ie))},token:Ee,providedIn:"root"}),Ee.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],Ee.ctorParameters=function(){return[{type:ie}]};var ye=function(){var e=this;this.messages=[],this.newMessage=new n.EventEmitter,K.serverResponse.subscribe((function(n){e.messages.push(n),e.newMessage.emit(n)})),K.serverNoticeResponse.subscribe((function(n){e.messages.push(n),e.newMessage.emit(n)}))};ye.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new ye},token:ye,providedIn:"root"}),ye.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],ye.ctorParameters=function(){return[]};var Re=function(){function e(){var e=this;this.whoStatus={},E.onWhoResponse.subscribe((function(n){e.whoStatus[n.nick]=n}))}return e.prototype.isAway=function(e){return!(!this.whoStatus[e]||!this.whoStatus[e].isAway)},e}();Re.ɵprov=n.ɵɵdefineInjectable({factory:function(){return new Re},token:Re,providedIn:"root"}),Re.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],Re.ctorParameters=function(){return[]},e.Author=he,e.AvatarHelper=ae,e.Away=u,e.AwayHandler=D,e.Channel=l,e.ChannelAndUserList=M,e.ChannelData=oe,e.ChannelInfo=N,e.ChannelListHandler=f,e.ChannelStatusHandler=j,e.ChannelTopicUpdate=F,e.ChannelUserList=C,e.ChannelsService=ve,e.ChannelsTopic=G,e.ConnectionStatusData=te,e.EmoteList=de,e.GenericMessage=ce,e.GmodeHandler=d,e.IRCMessage=H,e.IRCParserV2=$,e.IRCoreModule=X,e.IRCoreService=re,e.IgnoreHandler=L,e.IndividualMessage=Q,e.Join=i,e.JoinHandler=z,e.KickHandler=o,e.KickInfo=a,e.ListHandler=I,e.MessageData=se,e.MessageHandler=J,e.MessageWithMetadata=me,e.ModeHandler=U,e.ModeratedHandler=Z,e.MotdHandler=W,e.NewMode=h,e.NickChange=T,e.OriginData=A,e.Part=_,e.PartHandler=r,e.PostProcessor=fe,e.PrivmsgData=we,e.PrivmsgService=Ee,e.Quit=q,e.QuitHandler=V,e.Quote=ue,e.QuoteMessage=pe,e.ServerHandler=K,e.ServerMsgService=ye,e.StatusHandler=P,e.Time=Y,e.UpdateChannelList=m,e.User=O,e.UserChannelList=g,e.UserInChannel=S,e.UserInfoService=ie,e.UserWithMetadata=ge,e.UsersHandler=k,e.UsersWhos=y,e.ValidRegex=x,e.WebSocketUtil=ee,e.Who=R,e.WhoDatas=w,e.WhoHandler=E,e.WhoIsData=p,e.WhoIsHandler=v,e.WhoStatusService=Re,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ircore.umd.min.js.map